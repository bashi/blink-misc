<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">

<link rel="import" href="interface-list.html">
<link rel="import" href="side-by-side-diff-view.html">

<dom-module id="diff-main-view">
  <template>
    <style>
     * {
       font-family: monospace;
     }
     #main-panel [main] {
       overflow-y: auto;
     }
     #main-panel [drawer] {
       overflow-y: auto;
     }
    </style>
    <paper-drawer-panel id="main-panel">
      <interface-list drawer id="list" names={{model.interfaceNames}}></interface-list>
      <side-by-side-diff-view main id="diff-view" leftTitle="WebKit" rightTitle="Blink">
      </side-by-side-diff-view>
    </div>
  </template>
  <script>
  Polymer({
    is: 'diff-main-view',
    properties: {
      model: {
        type: Object,
        notify: true
      }
    },
    ready: function() {
      var list = document.querySelector('#list');
      list.addEventListener('interface-selected',
                            this._onInterfaceSelected.bind(this));
      document.querySelector('#diff-view').leftTitle = 'WebKit';
      document.querySelector('#diff-view').rightTitle = 'Blink';
    },
    showSideBySideDiff: function(name) {
      if (!this.model)
        return;
      var diffs = this.model.getDiff(name);
      var items = [];
      var convertFunc = function(a, b) {
        for (var i = 0; i < a.length; i++) {
          items.push({left: a[i], right: b[i]});
        }
      };
      convertFunc(diffs.attributes.a, diffs.attributes.b);
      convertFunc(diffs.operations.a, diffs.operations.b);
      console.log(items);
      document.querySelector('#diff-view').items = items;
    },
    _onInterfaceSelected: function(e) {
      //this.showDiff(e.detail.name);
      this.showSideBySideDiff(e.detail.name);
    }
  });
  </script>
</dom-module>
